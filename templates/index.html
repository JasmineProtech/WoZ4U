<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="../static/style.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script type=text/javascript>

  //applies styling to a toggle button, depending on the value it should take
  function toggle_btn_handle(identifier, bool, onText="ON", offText="OFF"){
    if (bool) {
      $(identifier).addClass("example_c_green");
      $(identifier).html(onText)
    } else {
      $(identifier).addClass("example_c_red");
      $(identifier).html(offText)
    }
  }

  //function connect_robot(robot_ip){
  function connect_robot(ip=""){
    if (ip=="") {
      console.log("no ip given: " + ip)
      robot_ip = document.getElementById("pepper_select_ips").value; // get ip from select option
    } else {
      console.log("ip given: " + ip)
      robot_ip = ip
    }

    $("#connect_btn").html("..."); // set btn text to ...
    $("#connect_btn").addClass("example_c_ongoing"); // give it the css class for "processing"
    $.getJSON( // async call flask function with arguments
      "/connect_robot?ip=" + robot_ip,
      function(data) {
        console.log(data);

        $("#tangential_collision").val(data["tangential_collision"] + "m")
        $("#orthogonal_collision").val(data["orthogonal_collision"] + "m")

        $("#engagement_states option[value=" + data["engagement_state"]).attr("selected", "selected");

        toggle_btn_handle("#toggle_btn_blinking", data["blinking_enabled"])
        toggle_btn_handle("#toggle_btn_basic_awareness", data["ba_is_running"])
        toggle_btn_handle("#toggle_head_breathing", data["head_breathing"])
        toggle_btn_handle("#toggle_arms_breathing", data["arms_breathing"])
        toggle_btn_handle("#toggle_body_breathing", data["body_breathing"])
        toggle_btn_handle("#toggle_legs_breathing", data["legs_breathing"])

      }).done(function() {
      $("#connect_btn").html("Connected"); // set btn text to ...
      $("#connect_btn").removeClass("example_c_ongoing"); // remove class for ongoing
      $("#connect_btn").addClass("example_c_green"); // give class for succes
    }).fail(function() {
      $("#connect_btn").css("background-color", "#E76F51"); // set color of button to red on fail  });
    })
  };

  function set_autonomous_state(){
    state = document.getElementById("autonomous_states").value;
    $("#auto_state_set").html("...")
    $("#auto_state_set").addClass("example_c_ongoing"); // give it the css class for "processing"
    $.getJSON( // async call flask function with arguments
      "/set_autonomous_state?state=" + state,
      function(data) {
        console.log(data);
    }).done(function() {
      $("#auto_state_set").html("Set")
      $("#auto_state_set").removeClass("example_c_ongoing"); // remove class for ongoing
      $("#auto_state_set").addClass("example_c_green"); // give class for succes
    }).fail(function() {
      $("#auto_state_set").removeClass("example_c_ongoing"); // remove class for ongoing
      $("#auto_state_set").addClass("example_c_red"); // give class for succes
      $("#auto_state_set").html("FAIL")

    })
  }

  function toggle_setting(setting){
    $("#toggle_btn_" + setting).addClass("example_c_ongoing"); // give it the css class for "processing"
    $("#toggle_btn_" + setting).removeClass("example_c_green"); // remove class for ongoing
    $("#toggle_btn_" + setting).removeClass("example_c_red"); // remove class for ongoing

    let curr_state =  $("#toggle_btn_" + setting).html()
    $("#toggle_btn_" + setting).html("...")
    $.getJSON( // async call flask function with arguments
      "/toggle_setting?setting=" + setting,
      function(data) {
        console.log(data);
        if (curr_state == "On") {
          $("#toggle_btn_" + setting).html("Off")
          $("#toggle_btn_" + setting).removeClass("example_c_ongoing"); // remove class for ongoing
          $("#toggle_btn_" + setting).addClass("example_c_red"); // give class for succes
        } else {
          $("#toggle_btn_" + setting).html("On")
          $("#toggle_btn_" + setting).removeClass("example_c_ongoing"); // remove class for ongoing
          $("#toggle_btn_" + setting).addClass("example_c_green"); // give class for succes
        }
      }
    )
  }

  function say_custom_text() {
    let text = $("#custom_text_msg").val();

    $("#custom_text_btn").html("..."); // set btn text to ...
    $("#custom_text_btn").addClass("example_c_ongoing"); // give it the css class for "processing"
    
    $.getJSON(
      "/say_text?msg=" + text,
      function(data) {
        console.log(data);
      }
    ).done(function() {
      $("#custom_text_btn").html("Say it")
      $("#custom_text_btn").removeClass("example_c_ongoing")
    })
  }

  function say_predefined_text(text, index) {
    $("#voice_cmd_"+index).html("..."); // set btn text to ...
    $("#voice_cmd_"+index).addClass("example_c_ongoing"); // give it the css class for "processing"
    
    $.getJSON(
      "/say_text?msg=" + text,
      function(data) {
        console.log(data);
      }
    ).done(function() {
      $("#voice_cmd_"+index).html("Say it")
      $("#voice_cmd_"+index).removeClass("example_c_ongoing")
    })
  }

  function play_audio(index) {
    $("#audio_file_"+index).html("..."); // set btn text to ...
    $("#audio_file_"+index).addClass("example_c_ongoing"); // give it the css class for "processing"
    
    $.getJSON(
      "/play_audio?index=" + index,
      function(data) {
        console.log(data);
      }
    ).done(function() {
      $("#audio_file_"+index).html("PLAY")
      $("#audio_file_"+index).removeClass("example_c_ongoing")
    })
  }

  function show_img(index) {
    // go over all buttons and send reset styling, there can always be only one image that is being displayed
    for (i = 0; i < 10; i++) {
      $("#image_"+i).html("SHOW")
      $("#image_"+i).removeClass("example_c_green")

    }
    $.getJSON(
      "/show_img?index=" + index,
      function(data) {
        console.log(data);
      }
    ).done(function() {
      $("#image_"+index).html("BEING SHOWN"); // set btn text
      $("#image_"+index).addClass("example_c_green")
    })
  }

  function set_engagement_state() {
    state = document.getElementById("engagement_states").value;
    $("#engagement_state_set").html("...")
    $("#engagement_state_set").addClass("example_c_ongoing"); // give it the css class for "processing"
    $.getJSON( // async call flask function with arguments
      "/set_engagement_state?state=" + state,
      function(data) {
        console.log(data);
      }
    ).done(function() {
      $("#engagement_state_set").html("Set")
      $("#engagement_state_set").removeClass("example_c_ongoing"); // remove class for ongoing
      $("#engagement_state_set").addClass("example_c_green"); // give class for succes
    }).fail(function() {
      $("#engagement_state_set").removeClass("example_c_ongoing"); // remove class for ongoing
      $("#engagement_state_set").addClass("example_c_red"); // give class for succes
      $("#engagement_state_set").html("FAIL")

    })
  }

  {% if reconnect %}
    console.log("reconnecting")
    connect_robot(ip='{{reconnect_ip}}')
  {% endif %}

</script>
</head>
<body>

<div class="grid-container">
  <!-- Pepper  select -->
  <div class="pepper_select">
    <h2>Select robot</h2>
    <div class="row">
      <select name="pepper_ips" id="pepper_select_ips">
        <option value="130.239.182.11">130.239.182.11</option>
        <option value="192.168.10.2">192.168.10.2</option>
        <option value="192.168.10.3">192.168.10.3</option>
      </select>
      <br>
      <br>
    </div>


      <div class="row">
        <a href="#" onclick="connect_robot(ip='')">
          <button class="example_c" id="connect_btn">Connect</button>
        </a>
      </div>
      <br>

      <div class="row">
        <a href="#" target="_blank">
          <button class="example_c" id="view_camera_stream">Show camera stream</button>
        </a>
      </div>
      <br>

      <div class="row">
        <a href="#" target="_blank">
          <button class="example_c" id="listen_microphone">Play microphone stream</button>
        </a>
      </div>
      <br>

      <div class="row">
        <a href="#" target="_blank">
          <button class="example_c" id="listen_microphone">Show tablet view</button>
        </a>
      </div>
      <br>

  </div>

  <div class="tablet">
    <h2>Pepper Tablet</h2>

    <div class="row">
      <div class="speech_lbl_wrapper">
        <span>Image 0</span>
      </div>
      <div class="speech_btn_wrapper">
        <button class="example_c" id="image_0" onclick="show_img(0)">SHOW</button>
      </div>
    </div>
    <br>

    <div class="row">
      <div class="speech_lbl_wrapper">
        <span>Image 1</span>
      </div>
      <div class="speech_btn_wrapper">
        <button class="example_c" id="image_1" onclick="show_img(1)">SHOW</button>
      </div>
    </div>
    <br>
    
    <div class="row">
      <div class="speech_lbl_wrapper">
        <span>Image 2</span>
      </div>
      <div class="speech_btn_wrapper">
        <button class="example_c" id="image_2" onclick="show_img(2)">SHOW</button>
      </div>
    </div>
    <br>
    
    <div class="row">
      <div class="speech_lbl_wrapper">
        <span>Image 3</span>
      </div>
      <div class="speech_btn_wrapper">
        <button class="example_c" id="image_3" onclick="show_img(3)">SHOW</button>
      </div>
    </div>
    <br>   

    <div class="row">
      <div class="speech_lbl_wrapper">
        <span>Image 4</span>
      </div>
      <div class="speech_btn_wrapper">
        <button class="example_c" id="image_4" onclick="show_img(4)">SHOW</button>
      </div>
    </div>
    <br>
        
    <div class="row">
      <div class="speech_lbl_wrapper">
        <span>Image 5</span>
      </div>
      <div class="speech_btn_wrapper">
        <button class="example_c" id="image_5" onclick="show_img(5)">SHOW</button>
      </div>
    </div>
    <br>
        
    <div class="row">
      <div class="speech_lbl_wrapper">
        <span>Image 6</span>
      </div>
      <div class="speech_btn_wrapper">
        <button class="example_c" id="image_6" onclick="show_img(6)">SHOW</button>
      </div>
    </div>
    <br>
        
    <div class="row">
      <div class="speech_lbl_wrapper">
        <span>Image 7</span>
      </div>
      <div class="speech_btn_wrapper">
        <button class="example_c" id="image_7" onclick="show_img(7)">SHOW</button>
      </div>
    </div>
    <br>
        
    <div class="row">
      <div class="speech_lbl_wrapper">
        <span>Image 8</span>
      </div>
      <div class="speech_btn_wrapper">
        <button class="example_c" id="image_8" onclick="show_img(8)">SHOW</button>
      </div>
    </div>
    <br>
        
    <div class="row">
      <div class="speech_lbl_wrapper">
        <span>Image 9</span>
      </div>
      <div class="speech_btn_wrapper">
        <button class="example_c" id="image_9" onclick="show_img(9)">SHOW</button>
      </div>
    </div>
    <br>
    
  </div>


  <!-- Pepper  settings -->
  <div class="autonomous_life_settings">
    <h2>Autonomous life settings</h2>

    <!-- COLUM 1-->
    <!-- <div style="width: 50%; float: left;"> -->
    <div style="width: 100%; float: left;">
      <div class="row">
        <div class="btn_label_wrapper">
          <span>
            Autonomous state: 
          </span> 
        </div>
        
        <div class="btn_wrapper">
          <select name="pepper_ips" id="autonomous_states">
            <option value="Interactive">Interactive</option>
            <option value="Solitary">Solitary</option>
            <option value="Safeguard">Safeguard</option>
            <option value="Disabled">Disabled</option>
          </select>
          <a href="#" onclick="set_autonomous_state()">
            <button class="example_c" id="auto_state_set">Set</button>
          </a>
        </div>

      </div>
      <br>

      <div class="row">
        <div class="btn_label_wrapper">
          <span>Tangential collision avoidance:</span>
        </div>
        <input type="text" placeholder="1" id="tangential_collision" style="width: 30%; float: left; margin-left: 10px;">
        <button id="tangential_collision_set" onclick="" class="example_c">Set</button>
      </div>
      <br>

      <div class="row">
        <div class="btn_label_wrapper">
          <span>Orthogonal collision avoidance:</span>
        </div>
        <input type="text" placeholder="1" id="orthogonal_collision" style="width: 30%; float: left; margin-left: 10px;">
        <button id="orthogonal_collision_set" onclick="" class="example_c">Set</button>
      </div>
      <br>

      <div class="row">
        <div class="btn_label_wrapper">
          <span>Toggle blinking: </span>
        </div>
        <div class="btn_wrapper">
          <button id="toggle_btn_blinking" onclick="toggle_setting('blinking')" class="example_c">On</button>
        </div>
      </div>
      <br>

      <div class="row">
        <div class="btn_label_wrapper">
          <span>Toggle basic awareness: </span>
        </div>
        <div class="btn_wrapper">
          <button id="toggle_btn_basic_awareness" onclick="toggle_setting('basic_awareness')" class="example_c">On</button>
        </div>
      </div>
      <br>

      <div class="row" style="position: relative;">
        <div class="btn_label_wrapper">
          <span>
            Engagement mode: 
          </span> 
        </div>
        
        <div class="btn_wrapper">
          <select name="engagement_state" id="engagement_states">
            <option value="Unengaged">Unengaged</option>
            <option value="SemiEngaged">SemiEngaged</option>
            <option value="FullyEngaged">FullyEngaged</option>
          </select>
          <a href="#" onclick="set_engagement_state()">
            <button class="example_c" id="engagement_state_set">Set</button>
          </a>
        </div>

      </div>
      <br>

      <div class="row">
        <div class="btn_label_wrapper">
          <span>Head breathing: </span>
        </div>
        <div class="btn_wrapper">
          <button id="toggle_head_breathing" onclick="toggle_setting('head_breathing')" class="example_c">On</button>
        </div>
      </div>
      <br>

      <div class="row">
        <div class="btn_label_wrapper">
          <span>Arms breathing: </span>
        </div>
        <div class="btn_wrapper">
          <button id="toggle_arms_breathing" onclick="toggle_setting('arms_breathing')" class="example_c">On</button>
        </div>
      </div>
      <br>

      <div class="row">
        <div class="btn_label_wrapper">
          <span>Body breathing: </span>
        </div>
        <div class="btn_wrapper">
          <button id="toggle_body_breathing" onclick="toggle_setting('body_breathing')" class="example_c">On</button>
        </div>
      </div>
      <br>

      <div class="row">
        <div class="btn_label_wrapper">
          <span>Legs breathing: </span>
        </div>
        <div class="btn_wrapper">
          <button id="toggle_legs_breathing" onclick="toggle_setting('legs_breathing')" class="example_c">On</button>
        </div>
      </div>
      <br>

    </div>

  </div>

  <!-- Pepper  speech commands -->
  <div class="pepper_speech">
    <h2>Pepper speech</h2>

    <div class="row">
      <span>Adjust volume</span>
      <input type="range" min="1" max="100" value="50">
    </div>
    <br>

    <div class="row">
      <span>Set speed</span>
      <input type="number" value="1">
    </div>
    <br>

    <div class="row">
      <span>Set pitch</span>
      <input type="number" value="1">
  </div>
  <br>
    
    <div class="row">
      <input type="text" placeholder="custom msg" id="custom_text_msg">
      <button class="example_c" onclick="say_custom_text()" id="custom_text_btn">SAY IT</button>
    </div>
    <br>
    <!-- COLUM 1: SPEECH-->
    <div style="width: 50%; float: left;">

      {%for msg in config["messages"]%}
      <!-- Here, we iterate over all the messages and create labels and buttons for each-->
      <div class="row">
        <div class="speech_lbl_wrapper">
          <span>{{msg["short"]}}</span>
        </div>
        <div class="speech_btn_wrapper">
          <button class="example_c" id="voice_cmd_{{loop.index0}}" onclick="say_predefined_text('{{msg["full_text"]}}', {{loop.index0}})">SAY IT</button>
        </div>
      </div>
      <br>

      {%endfor%} 

  </div>

  <!-- COLUM 2: Audio files-->
  <div style="width: 50%; float: left;">

    <div class="row">
      <div class="speech_lbl_wrapper">
        <span>Audio 0</span>
      </div>
      <div class="speech_btn_wrapper">
        <button class="example_c" id="audio_file_0" onclick="play_audio(0)">PLAY</button>
      </div>
    </div>
    <br>
        
    <div class="row">
      <div class="speech_lbl_wrapper">
        <span>Audio 1</span>
      </div>
      <div class="speech_btn_wrapper">
        <button class="example_c" id="audio_file_1" onclick="play_audio(1)">PLAY</button>
      </div>
    </div>
    <br>

    <div class="row">
      <div class="speech_lbl_wrapper">
        <span>Audio 2</span>
      </div>
      <div class="speech_btn_wrapper">
        <button class="example_c" id="audio_file_2" onclick="play_audio(2)">PLAY</button>
      </div>
    </div>
    <br>

    <div class="row">
      <div class="speech_lbl_wrapper">
        <span>Audio 3</span>
      </div>
      <div class="speech_btn_wrapper">
        <button class="example_c" id="audio_file_3" onclick="play_audio(3)">PLAY</button>
      </div>
    </div>
    <br>

    <div class="row">
      <div class="speech_lbl_wrapper">
        <span>Audio 4</span>
      </div>
      <div class="speech_btn_wrapper">
        <button class="example_c" id="audio_file_4" onclick="play_audio(4)">PLAY</button>
      </div>
    </div>
    <br>

    <div class="row">
      <div class="speech_lbl_wrapper">
        <span>Audio 5</span>
      </div>
      <div class="speech_btn_wrapper">
        <button class="example_c" id="audio_file_5" onclick="play_audio(5)">PLAY</button>
      </div>
    </div>
    <br>

    <div class="row">
      <div class="speech_lbl_wrapper">
        <span>Audio 6</span>
      </div>
      <div class="speech_btn_wrapper">
        <button class="example_c" id="audio_file_6" onclick="play_audio(6)">PLAY</button>
      </div>
    </div>
    <br>

    <div class="row">
      <div class="speech_lbl_wrapper">
        <span>Audio 7</span>
      </div>
      <div class="speech_btn_wrapper">
        <button class="example_c" id="audio_file_7" onclick="play_audio(7)">PLAY</button>
      </div>
    </div>
    <br>

    <div class="row">
      <div class="speech_lbl_wrapper">
        <span>Audio 8</span>
      </div>
      <div class="speech_btn_wrapper">
        <button class="example_c" id="audio_file_8" onclick="play_audio(8)">PLAY</button>
      </div>
    </div>
    <br>

    <div class="row">
      <div class="speech_lbl_wrapper">
        <span>Audio 9</span>
      </div>
      <div class="speech_btn_wrapper">
        <button class="example_c" id="audio_file_9" onclick="play_audio(9)">PLAY</button>
      </div>
    </div>
    <br>

  </div>

  </div>

  <!-- Camera stream  -->
  <!-- 
  <div class="camera">
    <h2>Camera</h2>
    <img src="../static/imgs/umea_logo.png" style="max-width: 400px">
  </div>  
  -->

  <!-- Pepper  motion comands -->
  <div class="pepper_motion">
    <h2>Pepper motion</h2>

    <div class="row">
      <img src="../static/imgs/arrow_keys.png" style="max-height:80px;">
      <table style="width:100%">
        <tr>
          <td style="text-align: right;">Move head</td>
          <td style="text-align: left;">: Arrow keys</td>
        </tr>
        <tr>
          <td style="text-align: right;">Rotate base</td>
          <td style="text-align: left;">: ALT + Arrow keys</td>
        </tr>
        <tr>
          <td style="text-align: right;">Drive</td>
          <td style="text-align: left;">: FN + Arrow keys</td>
        </tr>
      </table>
    </div>
    <br>

    <div class="row">
      <div class="speech_lbl_wrapper">
        <span>Motion 1</span>
      </div>
      <div class="speech_btn_wrapper">
        <button class="example_c">Execute</button>
      </div>
    </div>
    <br>

    <div class="row">
      <div class="speech_lbl_wrapper">
        <span>Motion 2</span>
      </div>
      <div class="speech_btn_wrapper">
        <button class="example_c">Execute</button>
      </div>
    </div>
    <br>

    <div class="row">
      <div class="speech_lbl_wrapper">
        <span>Motion 3</span>
      </div>
      <div class="speech_btn_wrapper">
        <button class="example_c">Execute</button>
      </div>
    </div>
    <br>

    <div class="row">
      <div class="speech_lbl_wrapper">
        <span>Motion 4</span>
      </div>
      <div class="speech_btn_wrapper">
        <button class="example_c">Execute</button>
      </div>
    </div>
    <br>

    <div class="row">
      <div class="speech_lbl_wrapper">
        <span>Motion 5</span>
      </div>
      <div class="speech_btn_wrapper">
        <button class="example_c">Execute</button>
      </div>
    </div>
    <br>

    <div class="row">
      <div class="speech_lbl_wrapper">
        <span>Motion 6</span>
      </div>
      <div class="speech_btn_wrapper">
        <button class="example_c">Execute</button>
      </div>
    </div>
    <br>

    <div class="row">
      <div class="speech_lbl_wrapper">
        <span>Motion 7</span>
      </div>
      <div class="speech_btn_wrapper">
        <button class="example_c">Execute</button>
      </div>
    </div>
    <br>

    <div class="row">
      <div class="speech_lbl_wrapper">
        <span>Motion 8</span>
      </div>
      <div class="speech_btn_wrapper">
        <button class="example_c">Execute</button>
      </div>
    </div>
    <br>

    <div class="row">
      <div class="speech_lbl_wrapper">
        <span>Motion 9</span>
      </div>
      <div class="speech_btn_wrapper">
        <button class="example_c">Execute</button>
      </div>
    </div>
    <br>

    <div class="row">
      <div class="speech_lbl_wrapper">
        <span>Motion 10</span>
      </div>
      <div class="speech_btn_wrapper">
        <button class="example_c">Execute</button>
      </div>
    </div>
    <br>

  </div>

  <!-- Footer -->
  <div class="footer">
    <h2>Other</h2>

    <div class="col_one_of_three">

      <div class="row">
        <div class="btn_label_wrapper">
          <span>Toggle eye light</span>
        </div>
        <div class="btn_wrapper">
          <button onclick="myFunction()" class="example_c">On</button>
        </div>
      </div>
      <br>

      <div class="row">
        <div class="btn_label_wrapper">
          <span>Toggle ear light</span>
        </div>
        <div class="btn_wrapper">
          <button onclick="myFunction()" class="example_c">On</button>
        </div>
      </div>
      <br>

    </div>

    <div class="col_one_of_three">
      <div class="row">
        <button class="example_c">Arbitrary action 0</button>
      </div>
      <br>

      <div class="row">
        <button class="example_c">Arbitrary action 1</button>
      </div>
      <br>

    </div>

    <div class="col_one_of_three">
      <div class="row">
        <button class="example_c">Arbitrary action 2</button>
      </div>
      <br>

      <div class="row">
        <button class="example_c">Arbitrary action 3</button>
      </div>
      <br>

    </div>
  </div>
</div>

</body>
</html>
